{% block header_wrapper %}
<header class="navbar navbar-static-top masthead">
  <div class="container d-flex align-items-center">

    <!-- Logo kiri -->
    <hgroup class="{{ g.header_class }} navbar-left">
      {% if g.site_logo %}
        <a class="logo" href="{{ h.url_for('home.index') }}">
          <img src="{{ h.url_for_static_or_external(g.site_logo) }}" alt="{{ g.site_title }}" />
        </a>
      {% else %}
        <h1><a href="{{ h.url_for('home.index') }}">{{ g.site_title }}</a></h1>
      {% endif %}
    </hgroup>

    <!-- Navigasi (desktop) -->
    <div class="d-none d-lg-flex flex-grow-1 justify-content-center">
      <nav class="section navigation">
        <ul class="nav nav-pills mb-0">
          {{ h.build_nav_main(
            ('dataset.search', _('Dataset')),
            ('organization.index', _('OPD')),
            ('group.index', _('Kategori')),
            ('home.about', _('Tentang'))
          ) }}
          {% if not c.userobj %}
            <li>{% link_for _('Login'), named_route='user.login' %}</li>
          {% endif %}
        </ul>
      </nav>
    </div>

    <!-- User Menu kanan -->
    {% if c.userobj %}
    <div class="account avatar authed d-flex align-items-center ml-auto" data-module="me" data-me="{{ c.userobj.id }}">
      <ul class="list-unstyled mb-0 d-flex align-items-center gap-2">
        <li>
          <a href="{{ h.url_for('user.read', id=c.userobj.name) }}" class="d-flex align-items-center gap-1">
            {{ h.user_image((c.user if c and c.user else ''), size=22) }}
            <span class="username">{{ c.userobj.display_name }}</span>
          </a>
        </li>

        {% if c.userobj.sysadmin %}
        <li>
          <a href="{{ h.url_for(controller='admin', action='index') }}">
            <i class="fa fa-gavel"></i> Sysadmin
          </a>
        </li>
        {% endif %}

        <li>
          <a href="{{ h.url_for('user.edit', id=c.userobj.name) }}">
            <i class="fa fa-cog"></i> Profile
          </a>
        </li>

        <li><a href="{{ h.url_for('dashboard.index') }}"><i class="fa fa-tachometer"></i> Dashboard</a></li>
        <li><a href="{{ h.url_for('/user/_logout') }}"><i class="fa fa-sign-out"></i> Keluar</a></li>
      </ul>
    </div>
    {% endif %}

    <!-- Hamburger mobile -->
    <button data-target="#main-navigation-toggle" data-toggle="collapse" class="navbar-toggle collapsed d-lg-none" type="button">
      <span class="sr-only">Toggle navigation</span>
      <span class="fa fa-bars"></span>
    </button>

    <!-- Navigasi collapse mobile -->
    <div class="collapse navbar-collapse d-lg-none" id="main-navigation-toggle">
      <nav class="section navigation">
        <ul class="nav nav-pills flex-column mb-0">
          {{ h.build_nav_main(
            ('dataset.search', _('Dataset')),
            ('organization.index', _('OPD')),
            ('group.index', _('Kategori')),
            ('home.about', _('Tentang'))
          ) }}
          {% if not c.userobj %}
            <li>{% link_for _('Login'), named_route='user.login' %}</li>
          {% endif %}

          {% if c.userobj %}
            <li class="mt-2"><strong>User Menu:</strong></li>
            <li>
              <a href="{{ h.url_for('user.read', id=c.userobj.name) }}">
                {{ c.userobj.display_name }}
              </a>
            </li>
            {% if c.userobj.sysadmin %}
            <li><a href="{{ h.url_for(controller='admin', action='index') }}">Sysadmin</a></li>
            {% endif %}
            <li><a href="{{ h.url_for('user.edit', id=c.userobj.name) }}">Profile</a></li>
            <li><a href="{{ h.url_for('dashboard.index') }}">Dashboard</a></li>
            <li><a href="{{ h.url_for('/user/_logout') }}">Keluar</a></li>
          {% endif %}
        </ul>
      </nav>
    </div>

  </div>
</header>

<!-- Inline CSS -->
<style>
header.masthead {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  z-index: 1030;
  background: #535353;
  padding: 8px 0;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  transition: all 0.3s ease;
}

header.masthead.scrolled {
  background: #3c3c3c;
  padding: 5px 0;
  box-shadow: 0 3px 12px rgba(0,0,0,0.3);
}

header.masthead img { max-height: 40px; transition: max-height 0.3s ease; }
header.masthead.scrolled img { max-height: 33px; }

body { padding-top: 65px; }

.nav-pills li { list-style: none; }
.nav-pills a, .account a {
  color: #fff;
  transition: color 0.2s;
}
.nav-pills a:hover, .account a:hover { color: #ffd966; }

.username { font-weight: 500; }
.account { margin-left: auto; }

@media (max-width: 992px) {
  .d-lg-flex { display: none !important; }
  .account ul { flex-direction: column; gap: 5px; }
}
</style>

<!-- Scroll JS -->
<script>
window.addEventListener("scroll", function() {
  var header = document.querySelector("header.masthead");
  if (header) {
    header.classList.toggle("scrolled", window.scrollY > 50);
  }
});
</script>
{% endblock %}
